(()=>{"use strict";const e="subscribers__item",t=`${e}--active`,r=document.querySelector(".subscribers");if(!r)throw Error("Not found the subscribers container!");const s=r.querySelectorAll(`.${e}`),o=e=>{for(const t of s){const r=t.querySelector(".subscribers__call-button"),s=t.querySelector(".subscribers__online");if(!r)throw Error("Not found a call button in a subscriber!");if(!s)throw Error("Not found a online text container in a subscriber!");if(e(t,r,s))break}},i=e=>{const t=e.dataset.subscriberId,r=e.dataset.subscriberFullName;if(!t)throw Error("Not found subscriber id in dataset in the current subscriber!");return{id:t,fullName:r||"User without name"}},n=(e,r)=>{e.classList.add(t),r.textContent="Online"},c=(e,r)=>{e.classList.remove(t),r.textContent="Offline"},a={},d="notify",u=`${d}--active`,b=document.querySelector(`.${d}`);if(!b)throw Error("Not found notify container!");const l=b.querySelector(".notify__text");if(!l)throw Error("Not found notify text container!");const f=()=>b.classList.remove(u);let w;window.subscribersWebSocket.addEventListener("open",(()=>{var e;window.addEventListener("focus",(()=>{window.subscribersWebSocket.send(JSON.stringify({type:"subscribers.online"}))})),e=(e,t)=>{window.callOffersWebSocket.send(JSON.stringify({type:"offer.connection",data:e})),((e,t=1/0)=>{clearTimeout(w),l.textContent=e,b.classList.add(u),t!==1/0&&(w=setTimeout(f,t))})(`You offered the user: ${t}`)},o(((t,r)=>{const{id:s,fullName:o}=i(t);r.onclick=()=>e(s,o)}))})),window.subscribersWebSocket.addEventListener("message",(({data:e})=>{const t=JSON.parse(e);switch(t.type){case"subscribers.online":{const e=t.data;r=e,o(((e,t,s)=>{const{id:o}=i(e);r[o]?(n(e,s),t.disabled=!1):(c(e,s),t.disabled=!0)}));break}case"subscriber.invite":(e=>{if(a[e])return clearTimeout(a[e]),void delete a[e];o(((t,r,s)=>{const{id:o}=i(t);if(o===e)return n(t,s),r.disabled=!1,!0}))})(t.data);break;case"subscriber.discard":(e=>{const t=setTimeout((()=>{o(((t,r,s)=>{const{id:o}=i(t);if(o===e)return c(t,s),r.disabled=!0,!0})),delete a[Number(t)]}),1e4);a[Number(t)]=t})(t.data)}var r}))})();